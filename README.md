# RAG エラー要約システム

実行時に発生したエラーメッセージを解析し、その根本原因と具体的な解決策を、日本語で、プログラミング知識のない初学者（素人）が即座に理解し、次の行動に移せるように要約・解説するシステムです。

## 前提条件

- Docker および Docker Compose がインストールされていること
- OpenAI API Key
- Pinecone API Key / Environment / Index Name

## セットアップ

1. **環境変数の設定**
   `.env.example` をコピーして `.env` を作成し、必要なAPIキーを入力してください。

   ```bash
   cp .env.example .env
   # .env ファイルを編集して API キーを設定してください。
   ```

2. **サービスの起動**
   Docker Compose を使用してサービスを起動します。

   ```bash
   docker-compose up -d
   ```

3. **初期データの投入**
   初回のみ、以下のコマンドを実行して初期データを Pinecone に投入してください。
   ※ コンテナが起動している必要があります。

   ```bash
   ./project_check.sh -ad
   ```

## 使用方法

エラーメッセージを含むテキストファイル（例: `error.txt`）を用意し、以下のコマンドを実行してください。

```bash
# ラッパースクリプトを使用（推奨）
# コマンドが失敗した場合、自動的にエラー要約システムが起動します
./w.sh python app.py
```

### 完全自動モードの設定（推奨）

この設定を行うと、ターミナルでコマンドを実行する際、自動的にエラー監視システムが裏で動作するようになります。
ユーザーは `w.sh` などを意識する必要はありません。

**設定手順:**

1. 以下のコマンドを実行して、設定を `.zshrc` に追加します。

   ```bash
   echo "source /Users/kazukiyanagi/Desktop/Projects/エラー要約システム/src/auto_wrapper.zsh" >> ~/.zshrc
   ```

2. 設定を反映させます。

   ```bash
   source ~/.zshrc
   ```

**仕組み:**
- Enterキーを押した瞬間に、実行しようとしているコマンドをチェックします。
- `cd` や `vim`、`claude` などの対話ツール**以外**のコマンドであれば、自動的に監視ラッパーを経由して実行します。
- エラーが発生した場合のみ、解析レポートが表示されます。正常終了時は何も起きません。

**除外コマンド:**
`cd`, `vim`, `git`, `docker`, `claude` などは自動監視の対象外としています。
対象外コマンドを追加したい場合は、`src/auto_wrapper.zsh` の `_ES_EXCLUDED_COMMANDS` リストを編集してください。

### 手動実行（デバッグ用）

```bash
docker-compose exec app python src/main.py error.txt
```

## システムの挙動

1. **解析**: エラー内容を解析します。
2. **検索**: Pinecone から類似の解決事例を検索します。
3. **要約**: 解析結果と検索結果をもとに、素人向けの解説を生成します。
4. **フィードバック**: 解決策が有効だった場合、`Y` を入力すると、その事例が学習され、次回以降の精度向上に役立てられます。
